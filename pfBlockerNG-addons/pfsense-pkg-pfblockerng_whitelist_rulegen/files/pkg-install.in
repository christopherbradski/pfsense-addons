#!/bin/sh


if [ "${2}" != "POST-INSTALL" ]; then
	exit 0
fi

# Make pfSense aware of this package
/usr/local/bin/php -f /etc/rc.packages %%PORTNAME%% ${2}

# Path to the virtual environment
VENV_PATH="/usr/local/pkg/pfblockerng-addon-whitelist_rulegen/venv"

# Create a virtual environment
/usr/local/bin/python3.11 -m venv ${VENV_PATH}

# Activate the virtual environment and install dependencies
. ${VENV_PATH}/bin/activate
pip install requests

# Deactivate the virtual environment
deactivate

/bin/chmod +x /usr/local/pkg/pfblockerng-addon-whitelist_rulegen/etc/rc.d/svc_whitelist.sh
/bin/ln -s /usr/local/pkg/pfblockerng-addon-whitelist_rulegen/etc/rc.d/svc_whitelist.sh /usr/local/etc/rc.d/svc_whitelist
